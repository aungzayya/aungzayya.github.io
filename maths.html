<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Quiz for Kids</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body {
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            font-family: 'Nunito', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quiz-container {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #answer-buttons .btn {
            font-size: 1.5rem;
            padding: 15px;
            font-weight: 700;
            border-radius: 12px;
            transition: all 0.2s ease-in-out;
        }
        .btn-answer {
            background-color: white;
            color: #2980b9;
            border: 2px solid #a9cce3;
        }
        /* hover , .btn-answer:focus
        .btn-answer:active, .btn-answer:hover, .btn-answer:focus {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        } */
        #question-text {
            font-size: 3.5rem;
            font-weight: 900;
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .progress-info {
            font-size: 1.2rem;
            font-weight: 700;
            color: #34495e;
        }
        .table .correct {
            background-color: #e8f8f5 !important; /* Softer green */
            color: #1abc9c;
            font-weight: bold;
        }
        .table .incorrect {
            background-color: #fdedec !important; /* Softer red */
            color: #e74c3c;
            font-weight: bold;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            font-weight: 700;
        }
        h1 {
            font-weight: 900;
        }
        .btn-primary {
            background-color: #3498db;
            border-color: #3498db;
            font-weight: 700;
            padding: 15px 40px !important;
            border-radius: 50px;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
            transform: scale(1.05);
        }
    </style>
</head>
<body>

    <div class="container text-center mt-4">

        <!-- Start Screen -->
        <div id="start-screen" class="quiz-container">
            <h1 class="mb-3">Single-Digit Addition Quiz!</h1>
            <p class="lead mb-4">Are you ready to test your math skills? You will get 30 questions.</p>
            <button id="start-btn" class="btn btn-primary btn-lg px-5 py-3">Start Quiz</button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="quiz-container d-none">
            <div class="d-flex justify-content-between mb-3 progress-info">
                <div>Question <span id="question-number">1</span> of 30</div>
                <div>Time: <span id="timer">0</span>s</div>
            </div>
            <h2 id="question-text" class="mb-4">1 + 1 = ?</h2>
            <div id="answer-buttons" class="row row-cols-5 g-3 justify-content-center">
                <!-- Answer buttons will be generated by JavaScript -->
            </div>
        </div>

        <!-- Report Screen -->
        <div id="report-screen" class="quiz-container d-none">
            <h1>Quiz Complete!</h1>
            <h3 id="score-summary" class="my-3">You scored 0 out of 30!</h3>
            
            <div class="my-4">
                <h4>Time per Question (in seconds)</h4>
                <canvas id="report-chart"></canvas>
            </div>

            <h4>Detailed Report</h4>
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Question</th>
                            <th>Your Answer</th>
                            <th>Correct Answer</th>
                            <th>Time (s)</th>
                        </tr>
                    </thead>
                    <tbody id="report-table-body">
                        <!-- Report rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <button id="play-again-btn" class="btn btn-primary btn-lg mt-3">Play Again</button>
        </div>

    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    $(document).ready(function() {

        const TOTAL_QUESTIONS = 30;
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let results = [];
        let questionTimer;
        let questionStartTime;
        let reportChart;
        let totalTimeTaken = 0;

        // Event Listeners
        $('#start-btn').on('click', startQuiz);
        $('#play-again-btn').on('click', playAgain);
        // Use event delegation for answer buttons since they are dynamically created
        $('#answer-buttons').on('click', '.btn', checkAnswer);

        function generateQuestions() {
            questions = [];
            for (let i = 0; i < TOTAL_QUESTIONS; i++) {
                const num1 = Math.floor(Math.random() * 10); // Single digit: 0-9
                const num2 = Math.floor(Math.random() * 10); // Single digit: 0-9
                questions.push({
                    txtQues: num1+" + " + num2 +" = ?",
                    correctAnswer: num1 + num2
                });
            }
        }

        function startQuiz() {
            // Reset state
            currentQuestionIndex = 0;
            score = 0;
            totalTimeTaken = 0;
            results = [];
            if (reportChart) {
                reportChart.destroy();
            }

            generateQuestions();
            $('#start-screen').addClass('d-none');
            $('#report-screen').addClass('d-none');
            $('#quiz-screen').removeClass('d-none');
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex >= TOTAL_QUESTIONS) {
                showReport();
                return;
            }

            const currentQuestion = questions[currentQuestionIndex];
            $('#question-number').text(currentQuestionIndex + 1);
            $('#question-text').text(currentQuestion.txtQues);

            // Generate and display answer buttons
            const answerOptions = generateAnswerOptions(currentQuestion.correctAnswer);
            const answerButtonsContainer = $('#answer-buttons');
            answerButtonsContainer.empty();
            answerOptions.forEach(answer => {
                const buttonHtml = `<div class="col"><button class="btn btn-answer w-100">${answer}</button></div>`;
                answerButtonsContainer.append(buttonHtml);
            });

            // Start timer for the question
            startTimer();
        }

        function generateAnswerOptions(correctAnswer) {
            let answers = new Set();
            answers.add(correctAnswer);

            // Generate 8 other unique incorrect answers
            // The max possible sum is 9 + 9 = 18
            while (answers.size < 5) {
                const randomOffset = Math.floor(Math.random() * 10) - 5; // -5 to +4
                let incorrectAnswer = correctAnswer + randomOffset;
                // Ensure answers are plausible (non-negative and not the correct one)
                if (incorrectAnswer >= 0 && incorrectAnswer !== correctAnswer) {
                    answers.add(incorrectAnswer);
                }
                // Fallback for edge cases
                // if (answers.size < 4) {
                //     answers.add(Math.floor(Math.random() * 19)); // 0-18
                // }
            }

            // Shuffle the answers
            // To sort numerically in ascending order, a compare function is needed.
            return Array.from(answers).sort((a, b) => a - b);
        }

        function startTimer() {
            questionStartTime = new Date();
            $('#timer').text('0');
            questionTimer = setInterval(() => {
                const timeElapsed = Math.floor((new Date() - questionStartTime) / 1000);
                $('#timer').text(timeElapsed);
            }, 1000);
        }

        function checkAnswer(event) {
            clearInterval(questionTimer);
            const selectedAnswer = parseInt($(event.target).text());
            const timeTaken = ((new Date() - questionStartTime) / 1000).toFixed(2);

            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.correctAnswer;

            if (isCorrect) {
                score++;
            }

            results.push({
                question: currentQuestion.txtQues,
                userAnswer: selectedAnswer,
                correctAnswer: currentQuestion.correctAnswer,
                timeTaken: parseFloat(timeTaken),
                isCorrect: isCorrect
            });

            totalTimeTaken += parseFloat(timeTaken);

            currentQuestionIndex++;
            displayQuestion();
        }

        function showReport() {
            $('#quiz-screen').addClass('d-none');
            $('#report-screen').removeClass('d-none');

            $('#score-summary').text(`You scored ${score} out of ${TOTAL_QUESTIONS}! ( Total: ${totalTimeTaken.toFixed(2)}s) `);

            // Populate detailed report table
            const reportBody = $('#report-table-body');
            reportBody.empty();
            results.forEach((result, index) => {
                const rowClass = result.isCorrect ? 'correct' : 'incorrect';
                const rowHtml = `
                    <tr class="${rowClass}">
                        <td>${index + 1}</td>
                        <td>${result.question}</td>
                        <td>${result.userAnswer}</td>
                        <td>${result.correctAnswer}</td>
                        <td>${result.timeTaken}s</td>
                    </tr>
                `;
                reportBody.append(rowHtml);
            });

            // Create bar chart
            const ctx = document.getElementById('report-chart').getContext('2d');
            //const chartLabels = results.map((_, index) => `Q${index + 1}`);
            const chartLabels = results.map((_, index) => questions[index].txtQues);
            
            const chartData = results.map(r => r.timeTaken);
            const chartColors = results.map(r => r.isCorrect ? 'rgba(75, 192, 192, 0.6)' : 'rgba(255, 99, 132, 0.6)');

            reportChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Time Taken (s)',
                        data: chartData,
                        backgroundColor: chartColors,
                        borderColor: chartColors.map(color => color.replace('0.6', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Time in Seconds'
                            }
                        }
                    }
                }
            });
        }

        function playAgain() {
            $('#report-screen').addClass('d-none');
            $('#start-screen').removeClass('d-none');
        }
    });
    </script>

</body>
</html>
